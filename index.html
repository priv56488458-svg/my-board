<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Табло: Фікс Слайдів</title>
    <style>
        body { margin: 0; padding: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
        .slide { display: none; width: 100vw; height: 100vh; animation: fadeIn 1s; }
        .slide.active { display: block; }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }
        .text-slide { display: flex; flex-direction: column; height: 100vh; padding: 40px; box-sizing: border-box; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); }
        h1 { color: #ff4444; font-size: 4rem; margin: 0 0 20px 0; text-align: center; text-transform: uppercase; border-bottom: 5px solid #ff4444; }
        
        /* Новини */
        .scroll-container { flex-grow: 1; overflow: hidden; position: relative; width: 100%; }
        .scroll-content { position: absolute; width: 100%; font-size: 2.3rem; line-height: 1.4; white-space: pre-wrap; animation: scrollUp 35s linear infinite; color: #ddd; }
        
        /* Вітання */
        .holiday-title { color: #ffd700; border-color: #ffd700; }
        .bday-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 40px; border: 10px double #ffd700; border-radius: 50px; background: rgba(255, 215, 0, 0.05); }
        .bday-text { font-size: 2.8rem; line-height: 1.3; text-align: center; font-weight: bold; color: #fff; }

        @keyframes scrollUp { from { top: 100%; } to { top: -180%; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #clock { position: absolute; top: 15px; right: 25px; font-size: 2rem; z-index: 100; background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="clock">00:00</div>

    <div class="slide active" id="slide1">
        <iframe src="https://alerts.in.ua/"></iframe>
    </div>

    <div class="slide text-slide" id="slide2">
        <h1>НОВИНИ</h1>
        <div class="scroll-container">
            <div id="news-content" class="scroll-content">Завантаження новин з таблиці...</div>
        </div>
    </div>

    <div class="slide text-slide" id="slide3">
        <h1>ВІТАННЯ</h1>
        <div class="bday-container">
            <div id="holiday-content" class="bday-text">Завантаження привітання...</div>
        </div>
    </div>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEa4Dv6ZUnOjwEpd31r3LpfChJt2Eq6qenSjpq72x5L_Rdpl28ge7jyF_qi_p0p-CVbp7m7UIHSv24/pub?output=csv';

        async function updateData() {
            try {
                const response = await fetch(csvUrl + '&t=' + new Date().getTime());
                const text = await response.text();
                
                // Надійний спосіб розділити A1 та B1 для Google Таблиць
                // Ми шукаємо першу кому, яка не знаходиться всередині лапок
                let index = -1;
                let inQuotes = false;
                for (let i = 0; i < text.length; i++) {
                    if (text[i] === '"') inQuotes = !inQuotes;
                    if (text[i] === ',' && !inQuotes) {
                        index = i;
                        break;
                    }
                }

                if (index !== -1) {
                    let newsPart = text.substring(0, index).trim();
                    let bdayPart = text.substring(index + 1).trim();

                    // Очищаємо від зайвих лапок
                    newsPart = newsPart.replace(/^"|"$/g, '').replace(/""/g, '"');
                    bdayPart = bdayPart.replace(/^"|"$/g, '').replace(/""/g, '"');

                    document.getElementById('news-content').innerText = newsPart;
                    document.getElementById('holiday-content').innerText = bdayPart;
                }
            } catch (e) {
                console.error("Помилка:", e);
                document.getElementById('news-content').innerText = "Помилка зв'язку з таблицею";
            }
        }

        let current = 1;
        function changeSlide() {
            document.getElementById('slide' + current).classList.remove('active');
            current = (current >= 3) ? 1 : current + 1;
            document.getElementById('slide' + current).classList.add('active');
            if (current === 1) updateData();
        }

        setInterval(changeSlide, 30000);
        updateData();
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('uk-UA', {hour: '2-digit', minute:'2-digit'});
        }, 1000);
    </script>
</body>
</html>
