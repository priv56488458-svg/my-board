<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Інформаційне Табло: Фінальна Версія</title>
    <style>
        body { margin: 0; padding: 0; background: #000; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        
        /* Слайди */
        .slide { display: none; width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 1.5s ease-in-out; }
        .slide.active { display: flex; flex-direction: column; opacity: 1; z-index: 1; }
        
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        /* Новини */
        .text-slide { padding: 60px 40px; box-sizing: border-box; background: #000; text-align: center; justify-content: center; }
        h1 { color: #ff4444; font-size: 3.5rem; margin: 0 0 20px 0; border-bottom: 4px solid #ff4444; text-transform: uppercase; letter-spacing: 5px; }
        .content-box { flex-grow: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; width: 100%; }
        #news-content { font-size: 1.8rem; line-height: 1.3; color: #eee; white-space: pre-wrap; text-align: left; max-width: 90%; }

        /* Вітання */
        #slide3 { 
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('Flag-Ukraine-carbon-gold-frameimage-from-torange_biz-free-photobank.jfif'); 
            background-size: cover; background-position: center;
            justify-content: center; align-items: center; text-align: center;
        }
        .bday-text-centered {
            padding: 40px 60px; max-width: 85%; font-size: 3.5rem;
            line-height: 1.4; font-weight: bold; color: #fff;
            text-shadow: 4px 4px 15px rgba(0,0,0,1);
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
        }

        /* ПРАВИЙ КУТ: Звичайний годинник */
        #clock { 
            position: absolute; top: 15px; right: 20px; font-size: 2.2rem; 
            background: rgba(0,0,0,0.8); padding: 8px 20px; border-radius: 10px; 
            z-index: 100; border: 1px solid #444; font-variant-numeric: tabular-nums;
        }

        /* ЛІВИЙ КУТ: Хронометр війни */
        #war-timer-container {
            position: absolute; top: 15px; left: 20px; z-index: 100;
            display: flex; flex-direction: column; align-items: flex-start;
        }
        .timer-label {
            font-size: 0.9rem; color: #ff4444; font-weight: bold; margin-bottom: 4px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8); letter-spacing: 1px;
        }
        .flip-style {
            background: #111; padding: 10px 15px; border-radius: 8px;
            border: 1px solid #333; font-family: 'Courier New', monospace;
            font-size: 1.8rem; color: #fff; letter-spacing: 2px;
            box-shadow: inset 0 0 10px #000, 0 5px 15px rgba(0,0,0,0.5);
            display: flex; gap: 5px;
        }
        .war-days { color: #ff4444; font-weight: 900; }

        /* Оверлей для Хвилини мовчання */
        #memorial-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: white; z-index: 9999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        #memorial-overlay h2 { font-size: 4rem; color: #ff4444; text-transform: uppercase; margin: 0; }
        #memorial-overlay p { font-size: 2rem; margin-top: 20px; color: #ccc; }
    </style>
</head>
<body>

    <audio id="memorial-audio" src="silence.mp3" preload="auto"></audio>

    <div id="memorial-overlay">
        <h2>ЗАГАЛЬНОНАЦІОНАЛЬНА<br>ХВИЛИНА МОВЧАННЯ</h2>
        <p>Вшануймо пам'ять загиблих захисників України</p>
    </div>

    <div id="war-timer-container">
        <div class="timer-label">ТРИВАЄ ПОВНОМАСШТАБНА ВІЙНА:</div>
        <div class="flip-style" id="war-timer">
            <span class="war-days" id="d-val">000</span> : <span id="t-val">00:00:00</span>
        </div>
    </div>

    <div id="clock">00:00:00</div>

    <div class="slide active" id="slide1">
        <iframe src="https://alerts.in.ua/"></iframe>
    </div>

    <div class="slide text-slide" id="slide2">
        <h1>НОВИНИ</h1>
        <div class="content-box">
            <div id="news-content">Оновлення новин...</div>
        </div>
    </div>

    <div class="slide" id="slide3">
        <div id="holiday-content" class="bday-text-centered">Завантаження...</div>
    </div>

    <script>
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEa4Dv6ZUnOjwEpd31r3LpfChJt2Eq6qenSjpq72x5L_Rdpl28ge7jyF_qi_p0p-CVbp7m7UIHSv24/pub?output=csv';

        // 1. ПАРСИНГ ТА ОНОВЛЕННЯ ДАНИХ
        function parseSmartCSV(text) {
            const result = [];
            let cell = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                let char = text[i];
                if (char === '"') inQuotes = !inQuotes;
                else if (char === ',' && !inQuotes) { result.push(cell); cell = ''; }
                else { cell += char; }
            }
            result.push(cell);
            return result;
        }

        async function updateData() {
            try {
                const response = await fetch(csvUrl + '&v=' + new Date().getTime());
                const fullText = await response.text();
                const data = parseSmartCSV(fullText);
                
                if (data.length >= 2) {
                    let news = data[0].replace(/""/g, '"').trim();
                    let bday = data[1].replace(/""/g, '"').trim();
                    bday = bday.split('\n').filter(line => line.trim() !== '' && line.trim() !== ',').join('\n');

                    document.getElementById('news-content').innerText = news;
                    document.getElementById('holiday-content').innerText = bday;
                    
                    const box = document.getElementById('news-content');
                    if (news.length > 600) box.style.fontSize = "1.4rem";
                    else if (news.length > 400) box.style.fontSize = "1.7rem";
                    else box.style.fontSize = "2.2rem";
                }
            } catch (e) { console.error("Помилка завантаження CSV"); }
        }

        // 2. ЛОГІКА ХВИЛИНИ МОВЧАННЯ
        function checkMemorialTime(currentTimeStr) {
            // Налаштований час: 09:00:00
            if (currentTimeStr === "09:00:00") {
                const audio = document.getElementById('memorial-audio');
                const overlay = document.getElementById('memorial-overlay');
                
                overlay.style.display = 'flex';
                audio.play().catch(e => console.log("Потрібна взаємодія користувача для звуку"));

                // Закрити оверлей через 65 секунд
                setTimeout(() => {
                    overlay.style.display = 'none';
                    audio.pause();
                    audio.currentTime = 0;
                }, 65000);
            }
        }

        // 3. ЛОГІКА ГОДИННИКІВ
        function updateTimers() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('uk-UA', {hour12: false});
            
            document.getElementById('clock').innerText = timeStr;
            checkMemorialTime(timeStr); // Перевірка на 09:00

            const startDate = new Date('2022-02-24T04:00:00');
            const diff = now - startDate;

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mins = Math.floor((diff / (1000 * 60)) % 60);
            const secs = Math.floor((diff / 1000) % 60);

            const pad = (n) => n.toString().padStart(2, '0');
            document.getElementById('d-val').innerText = days;
            document.getElementById('t-val').innerText = `${pad(hours)}:${pad(mins)}:${pad(secs)}`;
        }

        // 4. ПЕРЕМИКАННЯ СЛАЙДІВ
        let current = 1;
        function changeSlide() {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(s => {
                s.classList.remove('active');
                setTimeout(() => { if(!s.classList.contains('active')) s.style.display = 'none'; }, 1500);
            });

            current = (current >= 3) ? 1 : current + 1;
            const nextSlide = document.getElementById('slide' + current);
            nextSlide.style.display = (current === 1) ? 'block' : 'flex';
            setTimeout(() => { nextSlide.classList.add('active'); }, 50);

            if (current === 1) updateData();
        }

        // Ініціалізація
        setInterval(changeSlide, 30000);
        setInterval(updateTimers, 1000);
        updateData();
        updateTimers();

        // Очищення пам'яті ТВ раз на добу
        setTimeout(() => { location.reload(); }, 86400000);

    </script>
</body>
</html>
